```{asis 11-ex-asis1, message=FALSE}
The solutions assume the following packages are attached (other packages will be attached when needed):
```

```{r setup11, include=FALSE}
poly_centroid = function(poly_mat) {
  Origin = poly_mat[1, ] # create a point representing the origin
  i = 2:(nrow(poly_mat) - 2)
  T_all = lapply(i, function(x) {rbind(Origin, poly_mat[x:(x + 1), ], Origin)})
  C_list = lapply(T_all, t_centroid)
  C = do.call(rbind, C_list)
  A = vapply(T_all, t_area, FUN.VALUE = double(1))
  c(weighted.mean(C[, 1], A), weighted.mean(C[, 2], A))
}
```

```{r 11-ex-e0}
library(sf)
```

E1. Przeczytaj skrypt[`11-centroid-alg.R`](https://github.com/geocompx/geocompr/blob/main/code/11-centroid-alg.R)wfolderze`code`repozytorium GitHub książki.

- Które z najlepszych praktyk omówionych w sekcji @ref(scripts) są w nim zastosowane?
- Utwórz wersję skryptu na swoim komputerze w IDE\\index{IDE}, takim jak RStudio\\index{RStudio}(najlepiej wpisując skrypt linia po linii, w swoim własnym stylu kodowania i z własnymi komentarzami, zamiast kopiować i wklejać — pomoże ci to nauczyć się pisania skryptów). Korzystając z przykładu wielokąta kwadratowego (np. utworzonego za pomocą`poly_mat = cbind(x = c(0, 9, 9, 0, 0), y = c(0, 0, 9, 9, 0))`),wykonaj skrypt linia po linii.
- Jakie zmiany można wprowadzić w skrypcie, aby był on bardziej powtarzalny?
- Jak można ulepszyć dokumentację?

```{asis 11-ex-e1, message=FALSE}
The script is stored in a logical location with a sensible file name.
The script is well documented with comments and the code is well formatted.
The script is reproducible.

Open a file and create a new script in RStudio, e.g., with the keyboard shortcut `Ctrl + Shift + N` (Windows) or `Cmd + Shift + N` (Mac), by clicking `File > New File > R Script` or by clicking the `+` icon in the top left of the `Source` pane.
You can also create a new R script from the R console with the command `file.create("11-centroid-alg.R")`.

The script is already reproducible, with a message stating that it needs an object called `poly_mat` to be present and, if none is present, it creates an example dataset at the outset for testing.
For people new to R it could also contain a comment stating that R must be installed before running the script.

Documentation could be improved with a more detailed description of the algorithm, including a link to the relevant section of the book.
Furthermore, the anonymous functions could be replaced with named functions and documented with Roxygen2 comments.
```

E2. W sekcji poświęconej algorytmom geometrycznym obliczyliśmy, że powierzchnia wielokąta`poly_mat`wynosi 245 jednostek kwadratowych, a jego środek ciężkości znajduje się w punkcie o współrzędnych (8,8; 9,2).

- Odtwórz wyniki na swoim komputerze, korzystając ze skryptu[`11-centroid-alg.R`](https://github.com/geocompx/geocompr/blob/main/code/11-centroid-alg.R), który jest implementacją tego algorytmu (bonus: wpisz polecenia – staraj się unikać kopiowania i wklejania).
- Czy wyniki są poprawne? Zweryfikuj je, konwertując`poly_mat`naobiekt`sfc`(o nazwie`poly_sfc`) za pomocą`st_polygon()`(wskazówka: ta funkcja przyjmuje obiekty klasy`list()`), a następnie używając`st_area()`i`st_centroid()`.

```{r 11-ex-e}
# We can verify the answer by converting `poly_mat` into a simple feature collection
# as follows, which shows the calculations match:
x_coords = c(10, 20, 12, 0, 0, 10)
y_coords = c(0, 15, 20, 10, 0, 0)
poly_mat = cbind(x_coords, y_coords)
poly_sfc = sf::st_polygon(list(poly_mat))
sf::st_area(poly_sfc)
sf::st_centroid(poly_sfc)
# By calling the script:
# source("https://github.com/geocompx/geocompr/raw/main/code/11-centroid-alg.R")
```

E3. Stwierdzono, że algorytm\\index{algorithm}, który stworzyliśmy, działa tylko dla*wypukłych powłok*. Zdefiniuj wypukłe powłoki\\index{convex hull}(zobacz rozdział dotyczący operacji geometrycznych) i przetestuj algorytm na wielokącie, który*nie*jestwypukłą powłoką.

```{r 11-ex-e3}
x_coords = c(10, 20, 12, 0, 0, 5, 10)
y_coords = c(0, 15, 20, 10, 0, 5, 0)
plot(x_coords, y_coords, type = "l")
poly_mat = cbind(x_coords, y_coords)
# source("https://github.com/geocompx/geocompr/raw/main/code/11-centroid-alg.R")
# Area from our script: 270
poly_sfc = sf::st_polygon(list(poly_mat))
sf::st_area(poly_sfc) # Actual area: 220
```

- Bonus 1: Zastanów się, dlaczego metoda ta działa tylko w przypadku wypukłych powłok i zwróć uwagę na zmiany, które należałoby wprowadzić do algorytmu, aby działał on również w przypadku innych typów wielokątów.
- Bonus 2: Opierając się na treści`11-centroid-alg.R`, napisz algorytm wykorzystujący wyłącznie podstawowe funkcje języka R, który pozwoli obliczyć całkowitą długość ciągów liniowych przedstawionych w postaci macierzy.

<!-- Todo: dodaj przykład macierzy reprezentującej ciąg liniowy, pokaż kod służący do weryfikacji odpowiedzi, zaproponuj alternatywne funkcje do dekompozycji jako bonus. -->

```{asis 11-ex-e3-bonus1}
The algorithm would need to be able to have negative as well as positive area values.

We leave Bonus 2 as an exercise for the reader.
```

E4. W sekcji funkcji stworzyliśmy różne wersjefunkcji`poly_centroid()`,która generowała wyniki klasy`sfg`(`poly_centroid_sfg()`) orazwynikitypu stabilnego`matrix`(`poly_centroid_type_stable()`).
Rozszerz funkcję, tworząc wersję (np. o nazwie`poly_centroid_sf()`),która jest typu stabilnego (akceptuje tylko dane wejściowe klasy`sf`)*i*zwracaobiekty`sf`(wskazówka: może być konieczne przekształcenie obiektu`x`w macierz za pomocą polecenia`sf::st_coordinates(x)`).

- Sprawdź, czy działa, uruchamiając`poly_centroid_sf(sf::st_sf(sf::st_sfc(poly_sfc)))`
- Jaki komunikat o błędzie otrzymujesz, próbując uruchomić`poly_centroid_sf(poly_mat)`?

```{r 11-ex-e4}
poly_centroid_sf = function(x) {
  stopifnot(is(x, "sf"))
  xcoords = sf::st_coordinates(x)
  centroid_coords = poly_centroid(xcoords)
  centroid_sf = sf::st_sf(geometry = sf::st_sfc(sf::st_point(centroid_coords)))
  centroid_sf
}
poly_centroid_sf(sf::st_sf(sf::st_sfc(poly_sfc)))
poly_centroid_sf(poly_sfc)
poly_centroid_sf(poly_mat)
```


